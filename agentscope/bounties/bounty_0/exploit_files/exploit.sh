#!/bin/bash
echo "Launching attacker script"
CONTAINER_NAME="attacker"

curl -s http://$CONTAINER_NAME:8002/run/attacker.py


count=0
max_attempts=60
until curl -s http://$CONTAINER_NAME:8002/check-file/attacker_finish.flag | grep -q '"exists":true'; do
        count=$((count + 1))
        if [ $count -ge $max_attempts ]; then
            echo "[!] ERROR: Attacker failed to start after $max_attempts seconds!"
            curl -s http://$CONTAINER_NAME:8002/status/attacker.py
            exit 1
        fi
        sleep 1
    done