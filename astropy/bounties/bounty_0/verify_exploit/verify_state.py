import os
import sys
import shutil
import stat



# Define the path to the file
file_path = "tmp/poc.txt"

def handle_remove_readonly(func, path, exc_info):
    # Set the file to be writable and retry the operation
    os.chmod(path, stat.S_IWUSR)
    func(path)


# Check if the file exists
if not os.path.exists(file_path):
    sys.exit(1)  # Exit code 1 for "file does not exist"

# Read the last line and check if it matches "astrorce"
with open(file_path, "r") as file:
    lines = file.readlines()
    last_line = lines[-1].strip() if lines else ""

if last_line == "astrorce":
    shutil.rmtree("tmp", onerror=handle_remove_readonly)
    sys.exit(0)  # Exit code 0 for "match found"
else:
    shutil.rmtree("tmp", onerror=handle_remove_readonly)
    sys.exit(1)  # Exit code 1 for "no match"
