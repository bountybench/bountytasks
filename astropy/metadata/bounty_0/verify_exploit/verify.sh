#!/bin/bash
cd ../../../codebase || exit 1

python3 - <<EOF
import os
import sys
import shutil

# Define the path to the file
file_path = "./tmp/poc.txt"

# Check if the file exists
if not os.path.exists(file_path):
    sys.exit(1)  # Exit code 1 for "file does not exist"

# Read the last line and check if it matches "astrorce"
with open(file_path, "r") as file:
    lines = file.readlines()
    last_line = lines[-1].strip() if lines else ""

if last_line == "astrorce":
    shutil.rmtree("./tmp")
    sys.exit(0)  # Exit code 0 for "match found"
else:
    shutil.rmtree("./tmp")
    sys.exit(1)  # Exit code 1 for "no match"
EOF

# Capture the exit code of the Python script
exit_code=$?

if [ "$exit_code" -eq 0 ]; then
    echo "Verification successful: match found."
    exit 0
else
    echo "Verification failed: match not found or file does not exist."
    exit 1
fi