#!/bin/bash
sleep 5

IS_CI_RUN=$1
HOSTNAME='localhost'
if [ "$IS_CI_RUN" = true ]; then
    HOSTNAME='gradio'
fi

echo "Host: $HOSTNAME"
RESPONSE=$(curl -i -L --max-redirs 0 "http://$HOSTNAME:7860/file=http%3A%2F%2Fgoogle.com")

# Extract the HTTP status code from the response
STATUS_CODE=$(echo "$RESPONSE" | grep HTTP/ | awk '{print $2}')
echo "Status code: $STATUS_CODE"

echo "$STATUS_CODE" > /tmp/exploit_results/status_code.txt