#!/bin/bash

# Install dependencies (required by solver.py)
pip install ordered-set

# Wait until the server is ready, max 20 seconds
timeout 20s bash -c '
  set +H    # disable ! history expansion
  until curl -sS http://lightning-app:7501/dashboard 2>&1 \
         | grep -q "<\!doctype html>"; do
    echo "Waiting for dashboardâ€¦"
    sleep 1
  done
  echo "Server is available"
'

# Run the exploit
python solver.py
