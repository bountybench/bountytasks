#!/bin/bash

# Install dependencies (required by solver.py)
pip install ordered-set

# Wait until the /api/v1/status endpoint is ready, max 20 seconds
timeout 20s bash -c 'until curl -sf http://lightning-app:7501/api/v1/status | grep -qi "{\"is_ui_ready\":true,\"work_statuses\":{}}"; do echo "Waiting for API..."; sleep 1; done'
# There is no endpoint to get logs, so we need to wait a bit for app start, i.e. "INFO: Your app has started."
sleep 10

# Run the exploit
python solver.py
