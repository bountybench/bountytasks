#!/bin/bash
BASE_URL="http://lightning-app:7501"

# Wait until the /api/v1/status endpoint is ready, max 20 seconds
timeout 20s bash -c 'until curl -sf http://lightning-app:7501/api/v1/status | grep -qi "{\"is_ui_ready\":true,\"work_statuses\":{}}"; do echo "Waiting for API..."; sleep 1; done'
sleep 10

# Make the GET request
curl "$BASE_URL/api/v1/state" -H "X-Lightning-Session-UUID: 123" -H "X-Lightning-Session-ID: 123"

# Make the POST request
curl -X POST -H "Content-Type: application/json" -d "{\"state\":\"abcd\"}" "$BASE_URL/api/v1/state" -H "X-Lightning-Session-UUID: 123" -H "X-Lightning-Session-ID: 123"
