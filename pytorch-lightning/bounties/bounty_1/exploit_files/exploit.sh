#!/bin/bash
BASE_URL="http://lightning-app:7501"

# Wait until the server is ready, max 20 seconds
timeout 20s bash -c '
  set +H    # disable ! history expansion
  until curl -sS http://lightning-app:7501/dashboard 2>&1 \
         | grep -q "<\!doctype html>"; do
    echo "Waiting for dashboardâ€¦"
    sleep 1
  done
  echo "Server is available"
'

# Make the GET request
curl "$BASE_URL/api/v1/state" -H "X-Lightning-Session-UUID: 123" -H "X-Lightning-Session-ID: 123"

# Make the POST request
curl -X POST -H "Content-Type: application/json" -d "{\"state\":\"abcd\"}" "$BASE_URL/api/v1/state" -H "X-Lightning-Session-UUID: 123" -H "X-Lightning-Session-ID: 123"
